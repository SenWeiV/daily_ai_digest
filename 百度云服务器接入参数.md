# 百度云服务器接入参数

> Daily AI Digest 后端部署服务器连接与配置指南

---

## 1. 服务器接入参数

| 参数 | 值 | 说明 |
|------|-----|------|
| **公网 IP** | `120.48.83.123` | 用于 SSH 登录和 API 访问 |
| **登录用户** | `root` | 当前使用 root 用户登录 |
| **SSH 端口** | `22`（默认） | 除非修改过，否则使用默认端口 |
| **连接命令** | `ssh root@120.48.83.123` | 在本地终端执行 |

### 1.1 SSH 连接示例

```bash
# 基础连接
ssh root@120.48.83.123

# 如果本地配置了 SSH Key
ssh -i ~/.ssh/your_key root@120.48.83.123
```

---

## 2. 文件上传方式

由于服务器无法直连 GitHub（`git clone` 会超时），采用**本机打包 → SCP 上传 → 服务器解压**的方案。

### 2.1 在本机（Mac/Linux）执行打包

```bash
cd /Users/weisen/Documents/small-project

# 打包项目（排除大文件和依赖）
tar \
  --exclude='news_from_github_youtube/frontend/node_modules' \
  --exclude='news_from_github_youtube/frontend/dist' \
  --exclude='news_from_github_youtube/backend/.venv' \
  --exclude='news_from_github_youtube/backend/venv' \
  --exclude='news_from_github_youtube/data/runtime' \
  -czf daily_ai_digest-src.tar.gz \
  -C news_from_github_youtube .

# 查看打包大小
ls -lh daily_ai_digest-src.tar.gz
```

### 2.2 SCP 上传到服务器

```bash
# 上传到服务器 /opt 目录
scp daily_ai_digest-src.tar.gz root@120.48.83.123:/opt/

# 如果 SSH 使用非默认端口（如 2222）
scp -P 2222 daily_ai_digest-src.tar.gz root@120.48.83.123:/opt/
```

### 2.3 在服务器上解压

```bash
# SSH 登录服务器
ssh root@120.48.83.123

# 创建目录并解压
cd /opt
mkdir -p daily_ai_digest
rm -rf daily_ai_digest/*

tar -xzf daily_ai_digest-src.tar.gz -C daily_ai_digest

# 验证文件
ls -la daily_ai_digest/
ls -la daily_ai_digest/backend/
```

---

## 3. 入站安全组配置

需要在百度云控制台配置安全组规则，放行以下端口：

| 端口 | 协议 | 源地址 | 用途 | 建议 |
|------|------|--------|------|------|
| `22` | TCP | `0.0.0.0/0` 或你的本地 IP | SSH 登录 | 生产环境建议限制为你的 IP |
| `8000` | TCP | `0.0.0.0/0` | 后端 API 访问（FastAPI）| GitHub Pages 调用需要公网访问 |

### 3.1 配置路径

1. 登录百度云控制台
2. 进入「云服务器」→「实例」
3. 选择对应实例 →「安全组」
4. 添加入站规则（如上表）

### 3.2 安全建议

- **SSH (22 端口)**：建议将源地址限制为你的本地网络 IP，而非 `0.0.0.0/0`
- **API (8000 端口)**：由于 GitHub Pages 没有固定 IP，需要开放公网访问
- 如需更高安全性，可考虑后续添加 Nginx + HTTPS（443 端口）

---

## 4. 验证命令

### 4.1 测试 SSH 连接

```bash
ssh root@120.48.83.123
```

连接成功后应看到服务器提示符：`root@instance-rk2a0jpz:~#`

### 4.2 测试后端 API（服务启动后）

```bash
# 本地回环测试（在服务器上执行）
curl -i http://127.0.0.1:8000/health

# 公网测试（在本机执行）
curl -i http://120.48.83.123:8000/health
```

期望返回：
```http
HTTP/1.1 200 OK
{"status":"healthy","service":"daily-ai-digest"}
```

### 4.3 查看 systemd 服务状态

```bash
ssh root@120.48.83.123 "systemctl status daily-ai-digest --no-pager"
```

---

## 5. 服务部署路径

| 路径 | 说明 |
|------|------|
| `/opt/daily_ai_digest` | 项目根目录 |
| `/opt/daily_ai_digest/backend` | 后端代码目录 |
| `/opt/daily_ai_digest/backend/.env` | 环境变量配置文件 |
| `/opt/daily_ai_digest/backend/.venv` | Python 虚拟环境 |
| `/etc/systemd/system/daily-ai-digest.service` | systemd 服务配置 |

---

## 6. 常见问题

### Q1: SCP 上传慢或中断？

- 检查本地网络连接
- 尝试压缩更小的包（排除更多不需要的文件）
- 使用 `rsync` 替代（如果可用）

### Q2: 连接超时？

- 检查安全组是否放行 22 端口
- 确认公网 IP 是否正确
- 检查本地网络是否能访问外网

### Q3: GitHub Pages 无法访问 API？

- 检查安全组是否放行 8000 端口
- 确认后端服务是否运行：`systemctl status daily-ai-digest`
- 检查 CORS 配置是否包含 `https://senweiv.github.io`

---

## 7. 更新记录

| 日期 | 更新内容 |
|------|----------|
| 2026-02-27 | 初始文档创建，整理接入参数和安全组配置 |
